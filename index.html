<!DOCTYPE html>
<html>
<head>
  <title>Rhythm Dodge Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script src="game.js"></script>

  <script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function updateCanvasSize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
let greenSquareY; 
let greenSquareX; 
const greenSquareSize = 50;
const rectangleWidth = 310; 
let rectangleHeight; 
const redSquareSize = 50;
let redSquareY;
const redSquareSpeed = 5;
let isLaserActive = false; 
let laserY;
const laserHeight = 20;
const laserSpeed = 10;
let isBlockHit = false;
let isKatanaActive = false; 
let katanaAngle = 0;
const katanaSwingSpeed = 0.1;
const katanaHeight = 100;
let score = 0;
let health = 100;
let redSquareX;
let redDead = false;

function initializeGame() {
  updateCanvasSize();
  greenSquareY = (canvas.height - greenSquareSize) - 50;
  greenSquareX = (canvas.width - greenSquareSize) / 2;
  rectangleHeight = canvas.height;
  redSquareY = -redSquareSize;
  redSquareX = Math.random() * (rectangleWidth - redSquareSize) + ((canvas.width - rectangleWidth) / 2);

}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'grey';
  ctx.fillRect((canvas.width - rectangleWidth) / 2, (canvas.height - rectangleHeight) / 2, rectangleWidth, rectangleHeight);
  ctx.fillStyle = 'green';
  ctx.fillRect(greenSquareX, greenSquareY, greenSquareSize, greenSquareSize);
  ctx.fillStyle = 'red';
  ctx.fillRect(redSquareX, redSquareY, redSquareSize, redSquareSize);
  ctx.fillStyle = 'white';
  ctx.font = 'bold 24px Arial';
  ctx.fillText('Score: ' + score, (canvas.width / 2) - 60, 30);
  ctx.fillStyle = 'white';
  ctx.font = 'bold 12px Arial';
  ctx.fillText('Health: ' + health, canvas.width - 715, 640);
  redSquareY += redSquareSpeed;
  // Check if the red square is out of the screen
  if (redSquareY > canvas.height || isBlockHit || redDead) {
    // Randomize the X position within the grey area
    redSquareX = Math.random() * (rectangleWidth - redSquareSize) + ((canvas.width - rectangleWidth) / 2);
    redSquareY = -redSquareSize;
    isBlockHit = false;
    redDead = false;
  }

  if (redSquareY > canvas.height) {
    redSquareY = -redSquareSize;
    score += 10;
  }
  if (redSquareY + redSquareSize >= greenSquareY + 5 && health != 0) {
    health -= 5;
    redSquareY = -redSquareSize;
  }

  if (isLaserActive) {
    laserY -= laserSpeed;
    const laserX = greenSquareX + greenSquareSize / 2 - 2.5; // Set the laser beam's X position
    const laserWidth = 5; // Set the laser beam's width
    if (
      laserY + laserHeight >= redSquareY &&
      laserY <= redSquareY + redSquareSize &&
      laserX + laserWidth >= redSquareX &&
      laserX <= redSquareX + redSquareSize
    ) {
      isBlockHit = true;
      redDead = true;
      score += 50;
      redSquareY = -redSquareSize;
    }

    if (laserY < 0 || isBlockHit) {
    // Reset laser beam
    isLaserActive = false;
    isBlockHit = false;
    }

    // Draw the laser beam
    ctx.fillStyle = 'violet';
    ctx.fillRect(greenSquareX + greenSquareSize / 2 - 2.5, laserY, 5, laserHeight);
  }

  // Check if the laser katana is active
  if (isKatanaActive) {
    // Update the katana swing angle
    katanaAngle += katanaSwingSpeed;

    // Check for collision between the laser katana and the red square
    if (
      katanaAngle >= Math.PI / 2 &&
      katanaAngle <= Math.PI &&
      greenSquareX >= (canvas.width - rectangleWidth) / 2 &&
      greenSquareX + greenSquareSize <= (canvas.width + rectangleWidth) / 2 &&
      redSquareY + redSquareSize >= greenSquareY - 20
    ) {
      // Block is hit
      isBlockHit = true;
      redDead = true;
      score += 50;
      redSquareY = -redSquareSize;
    }

    // Check if the katana swing is complete
    if (katanaAngle >= Math.PI / 1.5) {
      // Reset laser katana
      isKatanaActive = false;
      isBlockHit = false;
    }

    // Draw the laser katana swing
    ctx.save();
    ctx.translate(greenSquareX + greenSquareSize / 2, (greenSquareY + greenSquareSize) -25);
    ctx.rotate(katanaAngle - 1.5);
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(greenSquareSize / 2, -katanaHeight);
    ctx.stroke();
    ctx.restore();
  }

  requestAnimationFrame(gameLoop);
}
window.addEventListener('resize', function() {
  updateCanvasSize();
  initializeGame();
});

document.addEventListener('keydown', function(event) {
  if (event.code === 'ArrowLeft') {
    if (greenSquareX > (canvas.width - rectangleWidth) / 2) {
      greenSquareX -= 10;
    }
  } else if (event.code === 'ArrowRight') {
    if (greenSquareX < (canvas.width - rectangleWidth) / 2 + rectangleWidth - greenSquareSize) {
      greenSquareX += 10;
    }
  } else if (event.code === 'KeyZ' && !isLaserActive) {
    isLaserActive = true;
    laserY = greenSquareY - laserHeight;
  } else if (event.code === 'KeyX' && !isKatanaActive) {
    // Activate the laser katana
    isKatanaActive = true;
    katanaAngle = 0;
  }
});

initializeGame();
gameLoop();
  </script>
</body>
</html>
